#!/bin/bash

# log파일로 해당 진단 내용 파일 생성 
. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE [ U-21 ] r계열 서비스 비활성화
cat << EOF >> $RESULT
[ 양호 ] : 불필요한 r계열 서비스가 비활성화 되어 있는 경우
[ 취약 ] : 불필요한 r계열 서비스가 활성화 되어 있는 경우
EOF
BAR

# ls -alL /etc/xinetd.d/* | egrep "rsh|rlogin|rexec" | egrep -v "grep|klogin|kshell|kexec"
SERVICELIST="rsh.socket rlogin.socket rexec.socket"
for i in $SERVICELIST
do
	RESP=$(systemctl is-active $i)
	if [ $RESP = 'active' ]; then
		WARN "r계열($i) 서비스가 활성화되어 있습니다."
		INFO $TMP1 파일을 확인해야 합니다.
		cat << EOF >> $TMP1
========================================================================
1. $i 서비스 상태
$(systemctl status $i)

========================================================================
EOF
	else
		OK "r계열($i) 서비스가 설치되어있지 않거나 비활성화되어 있습니다."
		rm $TMP1
	fi
done

cat $RESULT
echo ;