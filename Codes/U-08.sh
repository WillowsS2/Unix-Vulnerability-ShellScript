#!/bin/bash

. function.sh

BAR
CODE [ U-08 ] /etc/shadow 파일 소유자 및 권한 설정
cat << EOF >> $RESULT
[ 양호 ] : /etc/shadow 파일의 소유자가 root이고, 권한이 400 이하인 경우
[ 취약 ] : /etc/shadow 파일의 소유자가 root가 아니거나, 권한이 400이 아닌 경우
EOF
BAR

SHADOWFILE=/etc/shadow

# 소유자 확인
CHECK1=$(ls -l $SHADOWFILE | awk '{print $3}') # 소유자 뽑아내는 명령어
if [ $CHECK1 == 'root' ] ; then
    OK $SHADOWFILE 의 소유자는 root입니다.
else
    WARN $SHADOWFILE 의 소유자가 root로 설정되어 있지 않습니다.
fi

# rwx 권한 확인
# -c : root 권한을 잠깐 얻어서 명령어만 실행함
# $? : 최근 실행된 명령어
CHECK2=`su - root -c 'find /etc/shadow -perm 400'`
if [ -n "$CHECK2" ] ; then # 출력 문자열이 0이 아닌 경우
    OK $SHADOWFILE 의 권한 설정이 되어있습니다.
else
    WARN $SHADOWFILE 의 권한 설정이 잘못 되어있습니다.
fi

cat $RESULT
echo;