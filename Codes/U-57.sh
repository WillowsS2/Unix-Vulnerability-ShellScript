#!/bin/bash

# log파일로 해당 진단 내용 파일 생성 
. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE [ U-57 ] 홈 디렉터리 소유자 및 권한 설정
cat << EOF >> $RESULT
[ 양호 ] : 홈 디렉터리 소유자가 해당 계정이고, 타 사용자 쓰기 권한이 제거된 경우
[ 취약 ] : 홈 디렉터리 소유자가 해당 계정이 아니고, 타 사용자 쓰기 권한이 부여된 경우
EOF
BAR

FILE=/etc/passwd

# 홈 디렉터리 소유자 확인
HOME=`cat /etc/passwd | grep 'sh$' | awk -F: '{print $6}'`
ls -ald $HOME | while read VAR
do
    # 소유자 확인
    CHECK1=`echo $VAR | awk '{print $9}' | awk -F/ '{print $NF}'`
    OWN=`echo $VAR | awk '{print $3}'`
    DIR=`echo $VAR | awk '{print $9}'`
    if [ "$CHECK1" == "$OWN" ] ; then
        OK $DIR 의 소유자는 $CHECK1 입니다.
    else
        WARN $DIR 의 소유자는 $CHECK1 입니다.
    fi
done

# 타 사용자 쓰기 권한 확인 755
# CHECK2=`ls -l $FILE | awk '{print $1}' | cut -c 2-`  # 권한만 출력하는 명령
find $FILE -perm -640 -ls | grep -v 'rwxr-xr-x' >> $TMP1
if [ -s $TMP1 ] ; then  # 파일 내용이 비어있는 경우
    WARN $FILE의 권한 설정을 다시해야 합니다.
    INFO $TMP1 파일을 확인해야 합니다.
else
    OK $FILE의 권한 설정이 올바르게 되어있습니다.
    rm $TMP1
fi

cat $RESULT
echo;