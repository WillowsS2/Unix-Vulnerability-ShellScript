#!/bin/bash

. function.sh

BAR
CODE [ U-25 ] NFS 접근 통제
cat << EOF >> $RESULT
[ 양호 ] : 불필요한 NFS 서비스를 사용하지 않거나, 불가피하게 사용 시 everyone 공유를 제한한 경우
[ 취약 ] : 불필요한 NFS 서비스를 사용하고 있고, everyone 공유를 제한하지 않은 경우
EOF
BAR

# nfs 실행여부, 마운트 확인
CHECK1=$(systemctl list-unit-files nfs-server.service | grep ^nfs | awk '{print $2}') # 결과가 없거나 disabled면 OK 출력
HOSTNAME=$(hostname)
CHECK2=$(showmount -e $HOSTNAME | grep everyone | wc -l)  # 0이면 OK 출력

if [[ $CHECK1 == 'disabled' || $CHECK2 = 0 ]] ; then
	OK "불필요한 NFS 서비스를 사용하지 않거나, 불가피하게 사용 시 everyone 공유를 제한한 경우"
else
	VULN "불필요한 NFS 서비스를 사용하고 있고, everyone 공유를 제한하지 않은 경우"
fi

# 파일 확인
FILE=/etc/exports
if [ -s $FILE ] ; then
  OK $FILE을 확인해봐야 합니다.
else
  WARN $FILE에 evryone 으로 시스템 마운트 할 수 없도록 설정되어 있지 않습니다.
fi

cat $RESULT
echo;