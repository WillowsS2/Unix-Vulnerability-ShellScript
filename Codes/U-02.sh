#!/bin/bash

# log파일로 해당 진단 내용 파일 생성 
. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE [ U-02 ] 패스워드 복잡성 검사
cat << EOF >> $RESULT
[ 양호 ] : 영문 숫자 특수문자가 혼합된 8 글자 이상의 패스워드가 설정된 경우.
[ 취약 ] : 영문 숫자 특수문자가 혼합되지 않은 8 글자 미만의 패스워드가 설정된 경우.
EOF
BAR

INFO $TMP1 패스워드 복잡성 설정은 고객과 상의해야 합니다.
INFO $TMP1 파일을 확인해야 합니다.

cat << EOF >> $TMP1
1. 패스워드 취약점 참고사항입니다.
========================================================================
* 암호의 최소 길이는 8글자 이상이어야 합니다.
* 패스워드 복잡성은 다음과 같습니다.
	1) 암호의 최소 클래스는 3가지 이상 포함되어야 합니다. (대소문자, 숫자, 특수기호)
	2) 이전의 암호화 3글자 이상 틀려야 합니다.
	3) 사용자 이름과 암호는 동일할 수 없습니다.
========================================================================

2. 점검한 결과입니다.
EOF

PWQUALITYFILE=/etc/security/pwquality.conf
echo "1) $PWQUALITYFILE 점검내용입니다." >> $TMP1
# 아래 문장 : 주석처리한 부분은 제외하고 설정되어있는 값만 출력함('항목 = 숫자'의 형태)
egrep -v '^$|^#' $PWQUALITYFILE | grep '=' >> $TMP1
echo "" >> $TMP1

cat << EOF >> $TMP1
	# 다음 사항은 설정 참고 사항입니다.
	minlen			: 패스워드 최소 길이
	minclass		: 패스워드 조합 포함 개수
	lcredit			: 소문자 포함 개수
	ucredit			: 대문자 포함 개수
	dcredit			: 숫자 포함 개수
	ocredit			: 특수문자 포함 개수
EOF
echo "" >> $TMP1


LOGINDEFSFILE=/etc/login.defs
echo "2) $LOGINDEFSFILE 점검 내용입니다." >> $TMP1
# 아래 문장 : 주석처리한 부분은 제외하고 설정되어있는  PASS_MIN_LEN 값만 출력함
egrep -v '^$|^#' $LOGINDEFSFILE | grep 'PASS_MIN_LEN' >> $TMP1
echo "" >> $TMP1

cat << EOF >> $TMP1
# 다음 사항은 설정 참고 사항입니다.
	PASS_MIN_LEN		: 패스워드 최소 길이 (지정된 값 + 1)
========================================================================
EOF
echo "" >> $TMP1
echo "" >> $TMP1

cat << EOF >> $TMP1
========================================================================
[ 정보 ] $PWQUALITYFILE = 패스워드 대소문자, 특수문자, 패스워드 길이 설정 관련 파일
[ 정보 ] $LOGINDEFSFILE = 패스워드 사용 기간 설정 관련 파일
EOF
echo "" >> $TMP1

cat $RESULT
echo;