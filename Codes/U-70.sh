#!/bin/bash

# log파일로 해당 진단 내용 파일 생성 
. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE [ U-70 ] expn, vrfy 명령어 제한
cat << EOF >> $RESULT
[ 양호 ] : SMTP 서비스 미사용 또는, noexpn, novrfy 옵션이 설정되어 있는 경우
[ 취약 ] : SMTP 서비스를 사용하고, noexpn, novrfy 옵션이 설정되어 있지 않는 경우
EOF
BAR

FILE=/etc/mail/sendmail.cf
cat << EOF >> $TMP1
novrfy
noexpn
EOF

# SMTP 서비스 활성화 여부 확인
ps -ef | grep sendmail | grep -v grep >> tmp.log
if [ -s tmp.log ] ; then
    WARN SMTP 서비스를 사용하고 있습니다.
    # noexpn, novrfy 옵션 설정 여부 확인
    cat $TMP1 | while read VAR
    do
        cat $FILE | grep PrivacyOptions | grep --color $VAR >/dev/null
        if [ $? -eq 0 ] ; then
            OK $VAR 옵션이 설정되어 있습니다.
        else
            WARN $VAR 옵션이 설정되어 있지 않습니다.
        fi
    done
else
    OK SMTP 서비스를 사용하고 있지 않습니다.
fi
rm tmp.log $TMP1

cat $RESULT
echo;