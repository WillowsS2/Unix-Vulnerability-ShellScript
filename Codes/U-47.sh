#!/bin/bash

# log파일로 해당 진단 내용 파일 생성 
. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1
TMP2=$(mktemp)

BAR
CODE [ U-47 ] 패스워드 최대 사용기간 설정
cat << EOF >> $RESULT
[ 양호 ] : 패스워드 최대 사용기간이 90일(12주) 이하로 설정되어 있는 경우
[ 취약 ] : 패스워드 최대 사용기간이 90일(12주) 이하로 설정되어 있지 않는 경우
EOF
BAR

FILE=/etc/login.defs

# 패스워드 최대 사용기간 확인
grep PASS_MAX_DAYS $FILE | egrep -v '^#|^$' >> $TMP2
SET=$(cat $TMP2 | awk '{print $2}')

if [ $SET -gt 90 ] ; then
    WARN "패스워드 최대 사용기간이 90일(12주) 이상입니다."
    INFO $TMP1 파일을 참고해야 합니다.
    echo "=============================================================" >> $TMP1
    echo "1. /etc/login.defs 파일 내용 중 PASS_MAX_DAYS 설정 부분입니다." >> $TMP1
    echo "" >> $TMP1
    cat $TMP2 >> $TMP1
    echo "=============================================================" >> $TMP1
else
    OK "패스워드 최대 사용기간이 90일(12주) 이하입니다."
fi

cat $RESULT
echo;