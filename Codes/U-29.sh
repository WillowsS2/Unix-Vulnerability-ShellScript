#!/bin/bash
. function.sh

BAR
CODE [ U-29 ] tftp, talk 서비스 비활성화
cat << EOF >> $RESULT
[ 양호 ] : tftp, talk, ntalk 서비스가 비활성화 되어 있는 경우
[ 취약 ] : tftp, talk, ntalk 서비스가 활성화 되어 있는 경우
EOF
BAR

# 불필요한 서비스 데몬 확인
# cat /etc/inetd.conf | grep "tftp|talk|ntalk" tftp dgram udp6 SRC nobody /usr/sbin/tftpd tftpd -n

# xinetd일 경우 진단 파일
cat << EOF >> tmp.log
/etc/xinetd.d/tftp
/etc/xinetd.d/talk
/etc/xinetd.d/ntalk
EOF

cat tmp.log | while read VAR
do
    LINE=`echo $VAR | awk -F/ '{print $NF}'`
    if [ -f $VAR ] ; then
        CHECK=`cat $VAR | grep disable | awk -F= '{print $2}'`
        if [[ ${CHECK} == *yes* ]] ; then
            OK $LINE 서비스가 비활성화 되어있습니다.
        else
            WARN $LINE 서비스가 활성화 되어 있습니다.
        fi
    else
        OK $LINE 서비스가 비활성화 되어있습니다.
    fi
done

# 진단 파일 삭제
rm tmp.log

cat $RESULT
echo;