#!/bin/bash

# log파일로 해당 진단 내용 파일 생성 
. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE [ U-34 ] DNS Zone Transfer 설정
cat << EOF >> $RESULT
[ 양호 ] : DNS 서비스 미사용 또는, Zone Transfer를 허가된 사용자에게만 허용한 경우
[ 취약 ] : DNS 서비스를 사용하며 Zone Transfer를 모든 사용자에게 허용한 경우
EOF
BAR

# FILE1=/etc/named.rfc1912.zones
FILE2=/etc/named.conf

# 활성화 여부 확인
ps -ef | grep named | grep -v grep >> $TMP1
if [ -s $TMP1 ] ; then
    WARN DNS 서비스를 사용 중입니다.
else
    OK DNS 서비스를 미사용 중입니다.
fi

# 파일 유무/허용범위 확인
if [ -f $FILE2 ] ; then  # 파일 유무 확인
    cat $FILE2 | grep 'allow-transfer' >/dev/null  # 허용범위 확인
    if [ $? == 0 ] ; then
        OK Zone Transfer를 허가된 사용자에게만 허용하고 있습니다.
    else
        WARN Zone Transfer를 모든 사용자에게 허용하고 있습니다.
    fi
else
    WARN $FILE2 이 존재하지 않습니다.
fi
rm $TMP1

cat $RESULT
echo;