#!/bin/bash

. function.sh

BAR
CODE [ U-01 ] root 계정 원격 접속 제한
cat << EOF >> $RESULT
[ 양호 ] : 원격 서비스를 사용하지 않거나 사용 시 직접 접속을 차단한 경우
[ 취약 ] : root 직접 접속을 허용하고 원격 서비스를 사용하는 경우
EOF
BAR

# telnet 점검
# STATUS1 : active  / inactive   //systemctl is-active xinetd
# STATUS2 : enabled / disabled   //systemctl is-enabled xinetd
STATUSTEL=`systemctl is-active xinetd`

CODE Telnet 접속 제한
if [ ${STATUSTEL} = 'inactive' ]; then
	OK 원격 서비스가 활성화 되어 있지 않습니다.
else
	WARN 원격 서비스가 활성화 되어 있습니다.
	if [ -f /etc/securetty ]; then
	INFO '/etc/securetty 파일이 존재합니다.'
		if grep -q 'pts/' /etc/securetty; then
			WARN '/etc/securetty 파일안에 pts/#이 존재합니다.'
		else
			OK '/etc/securetty 파일안에 pts/#이 존재하지 않습니다.'
		fi
	else
		WARN '/etc/securetty 파일이 존재하지 않습니다.'
	fi
fi


# ssh 점검
STATUSSSH=`cat /etc/ssh/sshd_config | grep PermitRootLogin`

CODE SSH 접속 제한
# if [[ ${STATUSSSH} == *yes* -a ${STATUSSSH} -ne "#PermitRootLogin"]]; then
if [[ ${STATUSSSH} == *yes* ]]; then
	WARN '/etc/ssh/sshd_config 파일의 PermitRootLogin을 주석처리해야 합니다.'
elif [[ "$STATUSSSH" == *no* || "$STATUSSSH" == "#PermitRootLogin" ]]; then
	OK '/etc/ssh/sshd_config 파일의 PermitRootLogin가 주석처리 되어있습니다.'
else
	INFO '/etc/ssh/sshd_config 파일을 찾을 수 없습니다.'
fi

cat $RESULT
echo;