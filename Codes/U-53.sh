#!/bin/bash

# log파일로 해당 진단 내용 파일 생성 
. function.sh
TMP1=`SCRIPTNAME`.log
> $TMP1

BAR
CODE [ U-53 ] 사용자 shell 점검
cat << EOF >> $RESULT
[ 양호 ] : 로그인이 필요하지 않은 계정에 /bin/false(/sbin/nologin) 쉘이 부여되어 있는 경우
[ 취약 ] : 로그인이 필요하지 않은 계정에 /bin/false(/sbin/nologin) 쉘이 부여되지 않은 경우
EOF
BAR

FILE1=/etc/passwd

# 불필요한 계정 확인 및 쉘 부여 확인 
cat /etc/passwd \
| egrep "^daemon|^bin|^sys|^adm|^listen|^nobody|^nobody4|^noaccess|^diag|^listen|^operator|^games|^gopher" \
| egrep -v "admin" \
| egrep "(bash$|ksh$|csh$|sh$)" >> $TMP1

if [ -s $TMP1 ] ; then
    WARN 로그인이 필요하지 않은 계정에 쉘이 부여되었습니다.
else
    OK 로그인이 필요하지 않은 계정에 쉘이 부여되지 않았습니다.
    rm $TMP1
fi

cat $RESULT
echo;